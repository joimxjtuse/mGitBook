**部分标记-清除算法**

对可能有循环引用的对象做群使用标记-清除算法，对其他对象进行内存管理时使用引用计数法。

算法中，对象呗涂成四种不同颜色来进行管理：

* 黑（BLACK）：绝对不是垃圾的对象；
* 白（WHITE）：绝对是垃圾的对象；
* 灰（GRAY）：搜索完毕的对象；
* 阴影（HATCH）：可能是循环垃圾的对象.

当根指针删除对某个对象的引用时，会将该对象标记为HATCH，然后对HATCH对象执行标记-清除算法来清除操作。

![](/assets/部分标记-清除算法来清理循环引用对象.png)

首先，在 \(a\) 中 A 被涂成了灰色。虽然程序对计数器执行了减量操作，但并不是对 A，而是对 B 的计数器进行了减量操作。下面在 \(b\) 中 B 也被涂成了灰色，不过这时程序并没有对 B 进行减量操作，而是对 C 进行了减量操作。在 \(c\) 中 C 被涂成灰色时，程序对 A 和 F 的计数器进行了减量操作。这样一来，A、B、C 的循环垃圾的计数器值都变成了 0。\(d\) 是 A、B、C、F 各个对象搜索结束后的样子。部分标记 - 清除算法的特征就是要涂色的对象和要进行计数器减量的对象不是同一对象，据此就可以很顺利地回收循环垃圾。

